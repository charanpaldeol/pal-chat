<script>
  const messagesDiv = document.getElementById('messages');
  const input = document.getElementById('messageInput');

  // ✅ Connect to your Fly.io WebSocket relay
  const socket = new WebSocket('wss://pal-chat-relay.fly.dev');

  socket.onopen = () => {
    console.log('✅ Connected to WebSocket relay');
  };

  socket.onmessage = (event) => {
    const msg = document.createElement('div');
    msg.className = "bg-gray-200 text-gray-800 px-4 py-2 rounded-xl self-start max-w-[75%]";
    msg.textContent = event.data;
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  };

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    // 💬 Show my message
    const myMsg = document.createElement('div');
    myMsg.className = "bg-blue-100 text-blue-800 px-4 py-2 rounded-xl self-end max-w-[75%]";
    myMsg.textContent = text;
    messagesDiv.appendChild(myMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    // 🚀 Send to server
    socket.send(text);
    input.value = "";
  }

  // ⌨️ Send on Enter
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') sendMessage();
  });
</script>
